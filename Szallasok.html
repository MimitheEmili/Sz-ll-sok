<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pizza oldal</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <style>
        .labels, input {
            margin-top: 20px;
        }
    </style>
    
</head>
<body>
    <div>

        <label class="labels">Adja meg a pizza nevét:</label>
        <input id="name" type="text">
        <br>
        <label class="labels">Adja meg, hogy vegán-e a pizza(1 igen, 0 nem):</label>
        <input id="isGlutenFree" type="number">
        <br>
        <label class="labels">Írja be a kép Url linkjét:</label>
        <input id="kepURL" type="url">
        <button id="button1" class="btn btn-primary">Mentés</button>
    </div>
    <div id="cardContainer">
        
    </div>

    <script>
        // GET

        let pizzak = [];
        fetch("https://pizza.kando-dev.eu/Pizza")
            .then(response => response.json())
            .then(data => {
                console.log(data);
                const cardContainer = document.getElementById("cardContainer");
                pizzak = [...data]
                data.forEach(pizza => {
                    console.log(pizzak.indexOf(pizza));
                    cardContainer.innerHTML += `
                        <div class="card" style="width: 18rem;">
                            <img src="${pizza.kepURL ? pizza.kepURL : "placeholder.jpg"}" class="card-img-top" alt="...">
                            <div class="card-body">
                                <h5 class="card-title">${pizza.name} ${pizza.kepURL}</h5>
                                <h6 class="card-subtitle mb-2 text-muted">${pizza.isGlutenFree ? "Vegán" : "Nem vegán"}</h6>
                                <button type="button" onclick="Torles(${pizza.id})" class="btn btn-danger">Törlés</button>
                                <button type="button" onclick="Modositas(${pizzak.indexOf(pizza)}), '${pizza.name}', ${pizza.isGlutenFree}, '${pizza.kepURL}')" class="btn btn-warning">Szerkesztés</button>
                            </div>
                        </div>
                    `;
                });
            })
            .catch(error => console.error("Hiba történt a lekérés során:", error));

        // POST

        document.getElementById("button1").onclick = function() {

            const name = document.getElementById("name").value;
            const isGlutenFreeValue = document.getElementById("isGlutenFree").value;
            const kepURL = document.getElementById("kepURL").value;


            fetch("https://pizza.kando-dev.eu/Pizza", {
                method: "POST",
                body: JSON.stringify({
                    name: name,
                    isGlutenFree: Number(isGlutenFreeValue),
                    kepURL: kepURL
                }),
                headers: {
                    "Content-Type": "application/json"
                }
            })
            .then(data => {
                console.log("Sikeres mentés:", data);
                setTimeout(() => {
                    location.reload();
                }, 5000);
            })
            .catch(error => {
                console.error('Hiba történt a kérés során:', error);
                alert('Hiba történt az adatok lekérése közben.');
            });

        }

// for (let i = 53; i <= 1059; i++) {
//     fetch(`https://nodejs.sulla.hu/data/${i}`, {
//                     method: "DELETE"
//                 })
    
// }

    


        // DELETE
        function Torles(id) {
            if (confirm("Biztosan törölni szeretnéd ezt a pizzát?")) {
                fetch(`https://pizza.kando-dev.eu/Pizza/${id}`, {
                    method: "DELETE"
                })
                .then(data => {
                    console.log("Sikeres törlés:", data);
                    location.reload();
                })
                .catch(error => console.error("Hiba történt a törlés során:", error));
            }
        }

        // PUT
        function Modositas(index, name, isGlutenFree, kepURL) {
            const newName = prompt("Adja meg a pizza új nevét:", name);
            if (newName !== null) {
                const newisGlutenFree = parseInt(prompt("Adja meg, hogy a pizza vegán-e vagy sem (1 igen, 0 nem):", isGlutenFree));
                const newkepURL = prompt("Adja meg a pizza új kép URL-jét:", kepURL);

                fetch(`https://pizza.kando-dev.eu/Pizza/${pizzak[index].id}`, {
                    method: "PUT",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        id: pizzak[index].id,
                        name: newName,
                        isGlutenFree: newisGlutenFree,
                        kepURL: newkepURL
                    })
                })
                .then(data => {
                    console.log("Sikeres szerkesztés:", data);
                    setTimeout(() => {
                        location.reload();
                    }, 1000); 
                    console.log(data)
                })
                .catch(error => console.error("Hiba történt a szerkesztés során:", error));
            }
        }
    </script>
   
</body>
</html>